// @ts-nocheck
const bcrypt=require("bcryptjs"),jwt=require("jsonwebtoken"),User=require("../models/User"),Role=require("../models/Role"),axios=require("axios"),Sport=require("../models/Sport"),{generateAccessToken:generateAccessToken,generateRefreshToken:generateRefreshToken}=require("../config/jwt");exports.sportList=async(e,t)=>{const s={"X-Application":"fslpapQyGZSmkZW3","X-Authentication":"UAieWoWy1voS1fqhg/r//VKstS7lul6+j7fS7GODp6M=","Content-Type":"application/json"},o=[{jsonrpc:"2.0",method:"SportsAPING/v1.0/listEventTypes",params:{filter:{}},id:1}],r={operatorId:"laser247",providerId:"SportRadar",token:"c0e509b0-6bc1-4132-80cb-71b54345af12"};try{const e=await axios.post("https://api.betfair.com/exchange/betting/json-rpc/v1",o,{headers:s}),a=e.data[0]?.result||[],n=await axios.post("https://scatalog.mysportsfeed.io/api/v1/core/getsports",r),i=n.data?.sports||[],p={},c={};for(const e of a)p[e.eventType.name.toLowerCase()]=e;for(const e of i)c[e.sportName.toLowerCase()]=e;let d=await Sport.findOne().sort("-position").select("position"),m=d?.position?d.position+1:1;const f=new Set([...Object.keys(p),...Object.keys(c)]);for(const e of f){const t=p[e],s=c[e],o=t?.eventType?.name||s?.sportName||"Unknown",r=t?.eventType||{id:"0",name:o},a={eventType:{id:r.id||"0",name:r.name||o},marketCount:t?.marketCount||0},n=s||{sportName:o,sportId:"0",status:"UNKNOWN"},i=await Sport.findOne({sportName:o});if(i)i.betfairSportList=a,i.sportradarSportList=n,i.timestamp=new Date,i.status=1,await i.save();else{const e=new Sport({sportName:o,sportId:Math.floor(1e5+9e5*Math.random()),position:m++,betfairSportList:a,sportradarSportList:n,isBettingEnabled:!1,status:1});await e.save()}}return t.status(200).json({message:"Sports synced from Betfair and Sportradar successfully",total:f.size})}catch(e){return console.error("Sync error:",e.message),t.status(500).json({message:"Failed to sync sports from Betfair and Sportradar",error:e.response?.data||e.message})}};