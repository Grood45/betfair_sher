// @ts-nocheck
const bcrypt=require("bcryptjs"),jwt=require("jsonwebtoken"),User=require("../models/User"),Role=require("../models/Role"),axios=require("axios"),Sport=require("../models/Sport"),{generateAccessToken:generateAccessToken,generateRefreshToken:generateRefreshToken}=require("../config/jwt");exports.sportList=async(e,t)=>{const s={"X-Application":"fslpapQyGZSmkZW3","X-Authentication":"UAieWoWy1voS1fqhg/r//VKstS7lul6+j7fS7GODp6M=","Content-Type":"application/json"},r=[{jsonrpc:"2.0",method:"SportsAPING/v1.0/listEventTypes",params:{filter:{}},id:1}];try{const e=await axios.post("https://api.betfair.com/exchange/betting/json-rpc/v1",r,{headers:s}),o=e.data[0]?.result||[],a=[{name:"Soccer",id:"sr:sport:1"},{name:"Tennis",id:"sr:sport:2"},{name:"Cricket",id:"sr:sport:3"},{name:"Basketball",id:"sr:sport:4"}],n=new Set;o.forEach((e=>n.add(e.eventType.name))),a.forEach((e=>n.add(e.name)));let i=await Sport.findOne().sort("-position").select("position"),p=i?.position?i.position+1:1;for(const e of n){const t=o.find((t=>t.eventType.name===e)),s=a.find((t=>t.name===e)),r=await Sport.findOne({sportName:e});if(r)r.betfairSportList=t||{eventType:{id:"0",name:e},marketCount:0},r.sportradarSportList=s||{id:"0",name:e},r.timestamp=new Date,r.status=1,await r.save();else{const r=new Sport({sportName:e,position:p++,betfairSportList:t||{eventType:{id:"0",name:e},marketCount:0},sportradarSportList:s||{id:"0",name:e},isBettingEnabled:!1,status:1});await r.save()}}const c=await Sport.countDocuments();return t.status(200).json({message:`Synced successfully. Total sports: ${c}`})}catch(e){return console.error("Error:",e.message),t.status(500).json({message:"Failed to sync sports",error:e.response?.data||e.message})}};