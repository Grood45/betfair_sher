// @ts-nocheck
const bcrypt=require("bcryptjs"),jwt=require("jsonwebtoken"),User=require("../models/User"),Role=require("../models/Role"),axios=require("axios"),Sport=require("../models/Sport"),{generateAccessToken:generateAccessToken,generateRefreshToken:generateRefreshToken}=require("../config/jwt");exports.sportList=async(t,e)=>{const s={"X-Application":"fslpapQyGZSmkZW3","X-Authentication":"nPScA9u3FW4UcPTzKZxuO2XQjuLyFfvVwdP7hVbwduw=","Content-Type":"application/json"},o=[{jsonrpc:"2.0",method:"SportsAPING/v1.0/listEventTypes",params:{filter:{}},id:1}],r={operatorId:"laser247",providerId:"SportRadar",token:"c0e509b0-6bc1-4132-80cb-71b54345af12"};try{const[t,a]=await Promise.all([axios.post("https://api.betfair.com/exchange/betting/json-rpc/v1",o,{headers:s}),axios.post("https://scatalog.mysportsfeed.io/api/v1/core/getsports",r)]),n=t.data[0]?.result||[],i=a.data?.sports||[],p={},c={};for(const t of n){p[t.eventType.name.trim().toLowerCase()]=t}for(const t of i){c[t.sportName.trim().toLowerCase()]=t}const l=new Set([...Object.keys(p),...Object.keys(c)]);let d=await Sport.findOne().sort("-position").select("position"),m=d?.position?d.position+1:1;for(const t of l){const e=t.charAt(0).toUpperCase()+t.slice(1),s=p[t]||null,o=c[t]||null,r=await Sport.findOne({sportName:new RegExp(`^${e}$`,"i")});if(r)r.betfairSportList=s,r.sportradarSportList=o,r.timestamp=new Date,r.status=1,await r.save();else{const t=new Sport({sportName:e,sportId:Math.floor(1e5+9e5*Math.random()),position:m++,betfairSportList:s?{status:1,msg:"Matched successfully",...s}:{status:0,msg:"No matching sport found from Betfair"},sportradarSportList:o?{status:1,msg:"Sportradar item present",...o}:{status:0,msg:"No matching sport found from Sportradar"},isBettingEnabled:!1,status:1});await t.save()}}return e.status(200).json({message:"All sports from Betfair and Sportradar synced successfully."})}catch(t){return console.error("Sync error:",t.message),e.status(500).json({message:"Failed to sync sports",error:t.response?.data||t.message})}};