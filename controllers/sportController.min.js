// @ts-nocheck
const bcrypt=require("bcryptjs"),jwt=require("jsonwebtoken"),User=require("../models/User"),Role=require("../models/Role"),axios=require("axios"),Sport=require("../models/Sport"),{generateAccessToken:generateAccessToken,generateRefreshToken:generateRefreshToken}=require("../config/jwt");exports.sportList=async(e,t)=>{const s={"X-Application":"fslpapQyGZSmkZW3","X-Authentication":"UAieWoWy1voS1fqhg/r//VKstS7lul6+j7fS7GODp6M=","Content-Type":"application/json"},r=[{jsonrpc:"2.0",method:"SportsAPING/v1.0/listEventTypes",params:{filter:{}},id:1}],o={operatorId:"laser247",providerId:"SportRadar",token:"c0e509b0-6bc1-4132-80cb-71b54345af12"};try{const e=await axios.post("https://api.betfair.com/exchange/betting/json-rpc/v1",r,{headers:s}),a=e.data[0]?.result||[],i=await axios.post("https://scatalog.mysportsfeed.io/api/v1/core/getsports",o),n=i.data?.sports||[],p={};for(const e of n)p[e.sportName.toLowerCase()]=e;let c=await Sport.findOne().sort("-position").select("position"),d=c?.position?c.position+1:1;for(const e of a){const{id:t,name:s}=e.eventType,r=(e.marketCount,p[s.toLowerCase()]||{}),o=await Sport.findOne({sportName:s});if(o)o.betfairSportList=e??{},o.sportradarSportList=r??{},o.timestamp=new Date,o.status=1,0===Object.keys(r).length&&o.markModified("sportradarSportList"),await o.save();else{const t=new Sport({sportName:s,position:d++,betfairSportList:e??{},sportradarSportList:r??{},isBettingEnabled:!1,status:1});0===Object.keys(r).length&&t.markModified("sportradarSportList"),await t.save()}}return t.status(200).json({message:"Event types synced with Betfair and Sportradar successfully"})}catch(e){return console.error("Sync error:",e.message),t.status(500).json({message:"Failed to sync sports from Betfair and Sportradar",error:e.response?.data||e.message})}};