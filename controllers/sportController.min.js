// @ts-nocheck
const bcrypt=require("bcryptjs"),jwt=require("jsonwebtoken"),User=require("../models/User"),Role=require("../models/Role"),axios=require("axios"),Sport=require("../models/Sport"),{generateAccessToken:generateAccessToken,generateRefreshToken:generateRefreshToken}=require("../config/jwt");exports.sportList=async(t,e)=>{const s={"X-Application":"fslpapQyGZSmkZW3","X-Authentication":"UAieWoWy1voS1fqhg/r//VKstS7lul6+j7fS7GODp6M=","Content-Type":"application/json"},o=[{jsonrpc:"2.0",method:"SportsAPING/v1.0/listEventTypes",params:{filter:{}},id:1}],r={operatorId:"laser247",providerId:"SportRadar",token:"c0e509b0-6bc1-4132-80cb-71b54345af12"};try{let t=await Sport.findOne().sort("-position").select("position"),a=t?.position?t.position+1:1;const i=await axios.post("https://api.betfair.com/exchange/betting/json-rpc/v1",o,{headers:s}),n=i.data[0]?.result||[],p=await axios.post("https://scatalog.mysportsfeed.io/api/v1/core/getsports",r),c=p.data?.sports||[],d={};for(const t of c){d[t.sportName.toLowerCase().trim()]=t}const f=new Set;for(const t of n){const{id:e,name:s}=t.eventType,o=s.toLowerCase().trim(),r=d[o]||{sportId:"0"};f.add(o);const i=await Sport.findOne({sportName:s});if(i)i.betfairSportList=t,i.sportradarSportList=r,i.timestamp=new Date,i.status=1,await i.save();else{const e=new Sport({sportName:s,sportId:Math.floor(1e5+9e5*Math.random()),position:a++,betfairSportList:t,sportradarSportList:r,isBettingEnabled:!1,status:1});await e.save()}}for(const t of c){const e=t.sportName.toLowerCase().trim();if(f.has(e))continue;const s=await Sport.findOne({sportName:t.sportName});if(s)s.betfairSportList=null,s.sportradarSportList=t,s.timestamp=new Date,s.status=1,await s.save();else{const e=new Sport({sportName:t.sportName,sportId:Math.floor(1e5+9e5*Math.random()),position:a++,betfairSportList:null,sportradarSportList:t,isBettingEnabled:!1,status:1});await e.save()}}return e.status(200).json({message:"All sports synced from Betfair and Sportradar successfully"})}catch(t){return console.error("Sync error:",t.message),e.status(500).json({message:"Failed to sync sports from Betfair and Sportradar",error:t.response?.data||t.message})}};