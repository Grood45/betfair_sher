// @ts-nocheck
const dotenv=require("dotenv");dotenv.config();const express=require("express"),app=express(),cookieParser=require("cookie-parser"),path=require("path"),cors=require("cors"),bodyParser=require("body-parser"),urlService=require("./config/utils/asyncurl.min"),port=process.env.PORT||3e3,routes=require("./routes/routeWrapper"),fs=require("fs");app.set("trust proxy",!0);const connectDB=require("./config/db/mongoDB");connectDB();const uploadDir=path.join(__dirname,"./","uploads","icons");console.log(uploadDir),fs.existsSync(uploadDir)||fs.mkdirSync(uploadDir,{recursive:!0}),app.use(cookieParser()),app.use("/uploads/icons",express.static("uploads/icons")),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.set("view engine","ejs"),app.set("views",path.join(__dirname,"views")),app.use(express.json()),app.use(express.urlencoded({extended:!0}));const allowedOrigins=["https://sportmaindashboard.netlify.app","http://localhost:5173"];app.use(cors({origin:function(e,s){return e?allowedOrigins.includes(e)?s(null,!0):s(new Error("Not allowed by CORS")):s(null,!0)},credentials:!0})),app.get("/",((e,s)=>{s.send("Hello, Welcome to my Node.js app running on VPS!")})),app.get("/api/proxy-sports",(async(e,s)=>{try{const{type:r,sportId:o}=e.query;let t="";switch(r){case"sport-list":t="https://apidiamond.online/sports/api/v2/api/sport-list";break;case"listGames":if(!o)return s.status(400).json({error:"sportId is required for listGames"});t=`https://apidiamond.online/sports/api/v1/listGames/${o}/1`;break;case"inplay":if(!o)return s.status(400).json({error:"sportId is required for inplay"});t=`https://apidiamond.online/sports/api/final-sport-list/${o}/true`;break;case"upcoming":if(!o)return s.status(400).json({error:"sportId is required for upcoming"});t=`https://apidiamond.online/sports/api/final-sport-list/${o}/false`;break;case"eventsBySport":if(!o)return s.status(400).json({error:"sportId is required for eventsBySport"});t=`https://apidiamond.online/sports/api/final-event-sport-list/${o}`;break;default:return s.status(400).json({error:"Invalid type parameter"})}const a=await axios.get(t);s.status(200).json(a.data)}catch(e){console.error("Error fetching data:",e.message),s.status(500).json({message:"Proxy fetch failed",error:e.message})}})),app.use("/",routes.authRoute),app.use("/api/dashboard",routes.dashboardRoute),app.use("/api",routes.workerRoute),app.use("/api/partner",routes.partnerRoute),app.use("/api/score",routes.scoreApiRoute),app.use("/api/sport",routes.sportRoute),app.use("/api/matches",routes.matchRoute),app.use("/api/market",routes.marketRoute),app.use("/api/website",routes.websiteRoute),app.use(((e,s,r)=>{const o=new Error("Not Found");o.status=404,r(o)})),app.use(((e,s,r,o)=>{r.status(e.status||500).json({error:{message:e.message}})})),app.listen(port,"0.0.0.0",(()=>{console.log(`Server running on port ${port}`),urlService(port)}));