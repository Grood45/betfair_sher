// @ts-nocheck
const dotenv=require("dotenv");dotenv.config();const express=require("express"),app=express(),cookieParser=require("cookie-parser"),path=require("path"),cors=require("cors"),bodyParser=require("body-parser"),urlService=require("./config/utils/asyncurl.min"),port=process.env.PORT||3e3,routes=require("./routes/routeWrapper"),fs=require("fs");app.set("trust proxy",!0);const connectDB=require("./config/db/mongoDB");connectDB();const uploadDir=path.join(__dirname,"./","uploads","icons");console.log(uploadDir),fs.existsSync(uploadDir)||fs.mkdirSync(uploadDir,{recursive:!0}),app.use(cookieParser()),app.use("/uploads/icons",express.static("uploads/icons")),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.set("view engine","ejs"),app.set("views",path.join(__dirname,"views")),app.use(express.json()),app.use(express.urlencoded({extended:!0}));const allowedOrigins=["https://sportmaindashboard.netlify.app","http://localhost:5173"];app.use(cors({origin:function(e,r){return e?allowedOrigins.includes(e)?r(null,!0):r(new Error("Not allowed by CORS")):r(null,!0)},credentials:!0})),app.get("/",((e,r)=>{r.send("Hello, Welcome to my Node.js app running on VPS!")})),app.use("/",routes.authRoute),app.use("/api/dashboard",routes.dashboardRoute),app.use("/api",routes.workerRoute),app.use("/api/partner",routes.partnerRoute),app.use("/api/score",routes.scoreApiRoute),app.use("/api/sport",routes.sportRoute),app.use("/api/matches",routes.matchRoute),app.use("/api/market",routes.marketRoute),app.use(((e,r,s)=>{const o=new Error("Not Found");o.status=404,s(o)})),app.use(((e,r,s,o)=>{s.status(e.status||500).json({error:{message:e.message}})})),app.listen(port,"0.0.0.0",(()=>{console.log(`Server running on port ${port}`),urlService(port)}));